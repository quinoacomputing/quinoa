#!/bin/bash

# Need Help?  Go to http://trilinos.sandia.gov/Trilinos10CMakeQuickstart.txt

# Notes on the cmake variables
#   - the -lz is for the compression library (commsplitter uses crc)
#   - MPI details are in the toolchain file

# Path to Trilinos source
TRILINOS_SRCDIR=${HOME}/research/workspace/Trilinos
TRIOS_SRCDIR=${TRILINOS_SRCDIR}/packages/trios

rm -f CMakeCache.txt

export TARGET_COMPILER=pgi

# Load the appropriate bash environment
source ${TRIOS_SRCDIR}/sampleScripts/config/cielo/loadenv.sh

TOOLCHAIN=${TRIOS_SRCDIR}/sampleScripts/config/cielo/toolchain-cnl-${TARGET_COMPILER}.cmake

INSTALL_PATH=/home/raoldfi/research/support/cnl/lib/trilinos

EXTRA_ARGS=$@

cmake \
    -D CMAKE_INSTALL_PREFIX=${INSTALL_PATH} \
    -D CMAKE_TOOLCHAIN_FILE=${TOOLCHAIN} \
    -D BUILD_SHARED_LIBS:BOOL=OFF \
    -D TPL_FIND_SHARED_LIBS:BOOL=OFF \
    -D Trilinos_LINK_SEARCH_START_STATIC:BOOL=ON \
\
    -D Trilinos_ENABLE_ALL_PACKAGES:BOOL=OFF \
    -D Trilinos_ENABLE_TESTS:BOOL=ON \
    -D Trilinos_EXTRA_LINK_FLAGS:STRING="-lz" \
\
    -D Trilinos_ENABLE_Trios:BOOL=ON \
\
   -D TPL_ENABLE_MPI:BOOL=ON \
\
    -D TPL_ENABLE_BLAS:STRING=ON \
    -D BLAS_LIBRARY_DIRS:FILEPATH="/opt/pgi/default/linux86-64/default/lib" \
    -D BLAS_LIBRARY_NAMES:STRING="acml" \
    -D TPL_ENABLE_LAPACK:STRING=ON \
    -D LAPACK_LIBRARY_DIRS:FILEPATH="/opt/pgi/default/linux86-64/default/lib" \
    -D LAPACK_LIBRARY_NAMES:STRING="acml" \
    -D HAVE_TEUCHOS_BLASFLOAT:BOOL=TRUE \
    -D CXX_COMPLEX_BLAS_WORKS:BOOL=TRUE \
\
    -D TPL_ENABLE_Gemini:BOOL=ON \
    -D Gemini_INCLUDE_DIRS:FILEPATH="/opt/cray/gni-headers/default/include" \
\
    $EXTRA_ARGS \
\
    ${TRILINOS_SRCDIR}
